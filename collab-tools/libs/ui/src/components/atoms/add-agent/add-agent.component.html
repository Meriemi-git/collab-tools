<form
  [formGroup]="agentForm"
  (ngSubmit)="onSubmit()"
  class="flex flex-column align-items-center"
>
  <div class="flex flex-row align-items-center">
    <div class="m-2">
      <h2 *ngIf="agent !== null; else agentIsNull">
        {{ agent.name }}
      </h2>
      <ng-template #agentIsNull>
        <h2>{{ 'add-agent.new_agent' | translate }}</h2>
      </ng-template>
    </div>
    <div class="m-2">
      <button
        *ngIf="agent"
        pButton
        type="button"
        icon="pi pi-times"
        class="p-button-rounded p-button-danger"
        (click)="clearAgent()"
      ></button>
    </div>
  </div>
  <div class="flex flex-row">
    <div class="m-2">
      <div class="field flex flex-column align-items-center">
        <label for="agent-name" class="sub-title">{{
          'add-agent.agent_name' | translate
        }}</label>
        <input
          type="text"
          pInputText
          id="agent-name"
          formControlName="agentName"
        />
      </div>
      <div class="field flex flex-column align-items-center">
        <label for="year" class="sub-title">{{
          'add-agent.agent_year' | translate
        }}</label>
        <input
          type="number"
          pInputText
          id="year"
          aria-describedby="year-help"
          formControlName="agentYear"
        />
      </div>
      <div class="field flex flex-column align-items-center">
        <label for="season" class="sub-title">{{
          'add-agent.agent_season' | translate
        }}</label>
        <input
          type="number"
          pInputText
          id="season"
          formControlName="agentSeason"
        />
      </div>
      <div class="field flex flex-column align-items-center">
        <label for="agent-image" class="sub-title">{{
          'add-agent.agent_image' | translate
        }}</label>
        <div
          class="flex flex-row justify-content-evenly align-items-center"
          style="width: 100%"
        >
          <div>
            <img
              *ngIf="agent && agentImage"
              [src]="ihs.getAgentImageByName(agentImage)"
              alt="{{ agent.name }} image"
              [width]="80"
            />
          </div>
          <div>
            <p-fileUpload
              #fileUpload
              [customUpload]="true"
              [auto]="true"
              mode="basic"
              [maxFileSize]="5242880"
              [multiple]="false"
              accept="image/*"
              id="agent-image"
              [showCancelButton]="false"
              (uploadHandler)="
                onImageUploaded($event.files); fileUpload.clear()
              "
            ></p-fileUpload>
          </div>
          <div>
            <button
              pButton
              type="button"
              icon="pi pi-times"
              class="p-button-rounded p-button-danger"
              (click)="removeImage()"
            ></button>
          </div>
        </div>
      </div>
      <div class="field flex flex-column align-items-center">
        <label for="side" class="sub-title">
          {{ 'add-agent.agent_primary_gadget' | translate }}
        </label>
        <p-dropdown
          [options]="gadgets | filter: 'type':['PERSONAL']"
          optionLabel="name"
          formControlName="agentPrimaryGadget"
          [placeholder]="'add-agent.select-gadget-placeholder' | translate"
        >
        </p-dropdown>
      </div>
    </div>
    <div class="m-2">
      <div class="field flex flex-column align-items-center">
        <label for="side" class="sub-title">{{
          'add-agent.agent_side' | translate
        }}</label>
        <p-dropdown
          [options]="sides"
          formControlName="agentSide"
          [placeholder]="'add-agent.select-side-placeholder' | translate"
        ></p-dropdown>
      </div>
      <div class="field flex flex-column align-items-center">
        <label for="roles" class="sub-title">{{
          'add-agent.agent_roles' | translate
        }}</label>
        <input
          type="text"
          pInputText
          id="roles"
          aria-describedby="roles-help"
          formControlName="agentRoles"
        />
      </div>
      <div class="field flex flex-column align-items-center">
        <label for="description" class="sub-title">{{
          'add-agent.agent_description' | translate
        }}</label>
        <textarea
          pInputTextarea
          type="text"
          formcontrolName="agentDescription"
          id="description"
          [rows]="5"
          [cols]="20"
        ></textarea>
      </div>
      <div class="field flex flex-column align-items-center">
        <label for="agentSecondaryGadgets" class="sub-title">{{
          'add-agent.agent_secondary_gadget' | translate
        }}</label>
        <p-multiSelect
          [options]="gadgets | filter: 'type':['COMMON']"
          optionLabel="name"
          formControlName="agentSecondaryGadgets"
          id="agentSecondaryGadgets"
          [selectionLimit]="2"
          [placeholder]="'add-agent.select-gadget-placeholder' | translate"
        ></p-multiSelect>
      </div>
    </div>
  </div>
  <div class="flex flex-row justify-content-between">
    <button
      type="button"
      pButton
      class="p-button p-button-danger m-4"
      (click)="onDelete()"
      [disabled]="agent === null"
      [label]="'add-agent.btn_delete' | translate"
    ></button>
    <button
      type="submit"
      pButton
      class="p-button p-button-primary m-4"
      [disabled]="agentForm.invalid"
    >
      {{ 'add-agent.btn_save' | translate }}
    </button>
  </div>
</form>
<p-confirmDialog
  key="delete-agent-confirmation"
  [header]="'add-agent.delete-agent-confirmation.title' | translate"
  icon="pi pi-exclamation-triangle"
  [message]="
    'add-agent.delete-agent-confirmation.message'
      | translate: { value: agent?.name }
  "
>
</p-confirmDialog>
